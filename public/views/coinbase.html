
<div class="topbar-container">
  <nav ng-controller="topbarController as topbar"
       class="tab-bar"
       ng-style="{'background': theme.view.navBarBackground, 'border-bottom': theme.view.navBarBorderBottom}">

    <!-- status bar -->
    <div ng-class="index.useViewManagedStatusBar ? 'status-bar' : 'no-status-bar'"
      ng-style="{'background': theme.view.statusBarBackground, 'border-bottom': theme.view.statusBarBorderBottom}">
    </div>

    <section class="left-small">
      <a class="p10"
         ng-click="topbar.goHome()">
        <span class="text-close" ng-style="{'color': theme.view.navBarButtonTextColor}">{{'Close'|translate}}</span>
      </a>
    </section>

    <section class="right-small">
      <a class="p10" style="line-height: 3rem" ng-click="$root.go('preferencesCoinbase')">
        <i class="fi-widget size-29" ng-style="{'color': theme.view.navBarButtonTextColor}"></i>
      </a>
    </section>

    <section class="middle tab-bar-section">
      <h1 class="title ellipsis" style="line-height: 3rem;" ng-style="{'color': theme.view.navBarTitleColor}">
        Buy & Sell Bitcoin
      </h1>
    </section>
  </nav>
</div>

<ion-content class="content coinbase p20b" ng-controller="coinbaseController as coinbase"
  ng-class="{'status-bar-content':index.useViewManagedStatusBar}" ng-style="{'background':theme.view.viewBackground}">

  <div class="onGoingProcess" ng-show="coinbase.loading || index.coinbaseLoading">
    <div class="onGoingProcess-content" ng-style="{'background':theme.view.progressBackground, 'color':theme.view.progressTextColor}">
    <div class="spinner">
      <div class="rect1"></div>
      <div class="rect2"></div>
      <div class="rect3"></div>
      <div class="rect4"></div>
      <div class="rect5"></div>
    </div>
    <span ng-show="coinbase.loading">Connecting to Coinbase...</span>
    <span ng-show="index.coinbaseLoading">{{index.coinbaseLoading}}</span>
    </div>
  </div>

  <div class="row" ng-show="index.coinbaseError || (index.coinbaseToken && !index.coinbaseAccount)">
    <div class="m20b box-notification" ng-show="index.coinbaseError">
      <ul class="no-bullet m0 size-12" ng-style="{'color':theme.view.viewAlertTextColor}">
        <li ng-repeat="err in index.coinbaseError.errors" ng-bind-html="err.message"></li>
      </ul>
    </div>
    <div class="m20b box-notification" ng-show="index.coinbaseToken && !index.coinbaseAccount">
      <div ng-style="{'color':theme.view.viewAlertTextColor}">
        <span>Your primary account should be a WALLET. Set your wallet account as primary and try again.</span>
      </div>
    </div>
    <div class="m10t text-center">
      <button
        class="dark-gray outline round tiny"
        ng-style="{'background':theme.view.secondaryButtonBackground, 'border':theme.view.secondaryButtonBorder, 'color':theme.view.secondaryButtonTextColor}"
        ng-click="index.initCoinbase(index.coinbaseToken)">
        Reconnect
      </button>
      <div class="m20t size-12">
        Or go to <a class="text-gray" ng-click="$root.go('preferencesCoinbase')">Preferences</a> and log out manually.
      </div>
    </div>
  </div>

  <div ng-if="!index.coinbaseToken && !index.coinbaseLoading && !index.coinbaseError" class="row">
    <div class="box-notification text-center size-12" ng-style="{'color':theme.view.viewAlertTextColor}" ng-show="index.coinbaseTestnet">
      <i class="fi-info"></i>
      Testnet wallets only work with Coinbase Sandbox Accounts
    </div>
    <div class="columns" ng-init="showOauthForm = false">
      <div class="text-center m20v">
        <img src="img/coinbase-logo.png" width="200">
      </div>
      <div class="text-center small-10 small-centered columns" ng-show="!showOauthForm">

        <p class="m20t text-gray size-12" ng-style="{'color':theme.view.viewSecondaryTextColor}">Connect your Coinbase account to get started</p>

        <a class="button light-gray outline round small"
          ng-click="coinbase.openAuthenticateWindow(); showOauthForm = true"
          ng-style="{'background':theme.view.secondaryButtonBackground, 'border':theme.view.secondaryButtonBorder, 'color':theme.view.secondaryButtonTextColor}">
          Connect to Coinbase
        </a>
        <div>
          <a href ng-click="showOauthForm = true" class="text-gray size-12"
            ng-style="{'color':theme.view.viewSecondaryTextColor}">
            Do you already have the Oauth Code?
          </a>
        </div>
      </div>
      <div class="text-center" ng-show="showOauthForm">
        <div class="text-left box-notification" ng-show="coinbase.error">
          <ul class="no-bullet m0 size-12" ng-style="{'color':theme.view.viewAlertTextColor}">
            <li ng-repeat="err in coinbase.error.errors" ng-bind-html="err.message"></li>
          </ul>
        </div>
        <form name="oauthCodeForm" ng-submit="coinbase.submitOauthCode(code)" novalidate>
          <label ng-style="{'color':theme.view.viewPrimaryTextColor}">OAuth Code</label>
          <input type="text" ng-model="code" ng-disabled="coinbase.loading"
          ng-attr-placeholder="{{'Paste the authorization code here'}}" required
          ng-style="{'color':theme.view.viewSecondaryTextColor, 'border-bottom-color':theme.view.viewListItemSeparatorColor}">
          <input
            class="button expand round"
            ng-style="{'background':theme.view.primaryButtonBackground, 'border':theme.view.primaryButtonBorder, 'color':theme.view.primaryButtonTextColor}"
            type="submit" value="Get started" ng-disabled="oauthCodeForm.$invalid || coinbase.loading">
        </form>
        <button class="button light-gray expand outline round"
          ng-click="showOauthForm = false; index.coinbaseError = null; coinbase.error = null"
          ng-style="{'background':theme.view.secondaryButtonBackground, 'border':theme.view.secondaryButtonBorder, 'color':theme.view.secondaryButtonTextColor}">
          <i class="fi-arrow-left"></i> <span class="tu">Back</span>
        </button>
      </div>
    </div>
  </div>

  <div ng-if="index.coinbaseToken && index.coinbaseAccount && !index.coinbaseError">

    <div class="p20v text-center" ng-show="index.coinbaseAccount" ng-click="index.updateCoinbase({updateAccount: true})"
      ng-style="{'color':theme.view.viewSectionHeaderColor, 'background':theme.view.viewSectionHeaderBackground}">
      <img src="img/coinbase-logo.png" width="100">
    </div>

    <ul ng-show="index.coinbaseAccount" class="no-bullet m0 size-12">
      <li class="line-b line-t p15 pointer"
          ng-click="$root.go('buyCoinbase')"
          ng-style="{'background':theme.view.viewListItemBackground, 'border-bottom-color':theme.view.viewListItemSeparatorColor, 'border-top-color':theme.view.viewListItemSeparatorColor}">
        <img src="img/buy-bitcoin.svg" alt="buy bitcoin" width="30">
        <span class="m10 text-normal text-bold" ng-style="{'color':theme.view.viewPrimaryTextColor}">Buy Bitcoin</span>
        <span class="right text-gray" ng-style="{'color':theme.view.viewSecondaryTextColor}">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
      <li class="line-b p15 pointer"
          ng-click="$root.go('sellCoinbase')"
          ng-style="{'background':theme.view.viewListItemBackground, 'border-bottom-color':theme.view.viewListItemSeparatorColor, 'border-top-color':theme.view.viewListItemSeparatorColor}">
        <img src="img/sell-bitcoin.svg" alt="sell bitcoin" width="30">
        <span class="m10 text-normal text-bold" ng-style="{'color':theme.view.viewPrimaryTextColor}">Sell Bitcoin</span>
        <span class="right text-gray" ng-style="{'color':theme.view.viewSecondaryTextColor}">
          <i class="icon-arrow-right3 size-24 right"></i>
        </span>
      </li>
    </ul>

    <div ng-show="index.coinbasePendingTransactions && !index.coinbaseError">
      <h4 class="title" ng-style="{'color':theme.view.viewSectionHeaderColor, 'background':theme.view.viewSectionHeaderBackground}">Activity</h4>
      <div class="m20b box-notification" ng-show="index.coinbasePendingError">
        <ul class="no-bullet m0 size-12" ng-style="{'color':theme.view.viewAlertTextColor}">
          <li ng-repeat="err in index.coinbasePendingError.errors" ng-bind-html="err.message"></li>
        </ul>
      </div>
      <div ng-repeat="(id, tx) in index.coinbasePendingTransactions | orderObjectBy:'updated_at':true track by $index"
        ng-click="coinbase.openTxModal(tx)"
        class="row collapse last-transactions-content"
        ng-style="{'background':theme.view.viewListItemBackground, 'border-bottom-color':theme.view.viewListItemSeparatorColor}">
        <div class="large-2 medium-2 small-2 columns">
          <img src="img/bought-pending.svg" alt="bought" width="24" ng-show="(tx.type == 'buy' || (tx.to && tx.type == 'send')) && tx.status != 'completed'">
          <img src="img/bought.svg" alt="bought" width="30" ng-show="(tx.type == 'buy' || (tx.to && tx.type == 'send')) && tx.status == 'completed'">
          <img src="img/sold-pending.svg" alt="sold" width="24" ng-show="tx.from && tx.type == 'send'">
          <img src="img/sold.svg" alt="sold" width="30" ng-show="!tx.from && tx.type == 'sell' && tx.status == 'completed'">
        </div>

        <div class="large-5 medium-5 small-5 columns">
          <div class="size-12 m5t" ng-style="{'color':theme.view.viewPrimaryTextColor}">
            <span ng-show="tx.type == 'sell' && tx.status == 'completed'">Sold</span>
            <span ng-show="tx.type == 'buy' && tx.status == 'completed'">Bought</span>
            <span class="text-bold" ng-style="{'color':theme.view.viewPrimaryTextColor}">
              <span ng-if="tx.type == 'sell' || (tx.type == 'send' && tx.from)" ng-style="{'color':theme.view.viewPrimaryTextColor}">-</span>{{tx.amount.amount.replace('-','')}} 
              {{tx.amount.currency}}
            </span>
          </div>
        </div>
        <div class="large-4 medium-4 small-4 columns text-right">
          <div ng-show="tx.error" class="m5t size-12" ng-style="{'color':theme.view.viewAlertTextColor}">
            Error
          </div>
          <div ng-show="!tx.error" class="m5t size-12 text-gray">
            <div ng-show="tx.status == 'completed'" ng-style="{'color':theme.view.viewSecondaryTextColor}">
              <time ng-if="tx.created_at">{{tx.created_at | amTimeAgo}}</time>
            </div>
            <div ng-show="tx.status == 'pending'" ng-style="{'color':theme.view.viewInfoTextColor}">
              <span class="label outline gray radius text-gray text-info" ng-if="tx.status == 'pending'">Pending</span>
            </div>
          </div>
        </div>
        <div class="large-1 medium-1 small-1 columns text-right" ng-style="{'color':theme.view.viewSecondaryTextColor}">
          <i class="icon-arrow-right3 size-18"></i>
        </div>
      </div>
    </div>

  </div>

  <div class="extra-margin-bottom"></div>
</ion-content>
