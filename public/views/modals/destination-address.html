<ion-modal-view ng-controller="destinationAddressController">

  <div ng-init="wallets[0] ? selectedWalletsOpt = true : selectedWalletsOpts = false; checkClipboard()">
    <nav class="tab-bar"
      ng-class="{'status-bar-space': index.useViewManagedStatusBar}"
      ng-style="{'background': skin.view.navBarBackground, 'border-bottom': skin.view.navBarBorderBottom}">

      <!-- status bar -->
      <div ng-class="index.useViewManagedStatusBar ? 'status-bar' : 'no-status-bar'"
        ng-style="{'background': skin.view.statusBarBackground, 'border-bottom': skin.view.statusBarBorderBottom}">
      </div>

      <div class="pr">

        <section class="left-small">
          <a ng-show="!editAddressbook && !addAddressbookEntry" ng-click="cancel()" class="p10" ng-style="{'color':skin.view.navBarButtonTextColor}">
            <span class="text-close" translate>Close</span>
          </a>
        </section>

        <section class="middle tab-bar-section">
          <h1 class="title ellipsis">
          {{walletName}}
          </h1>
        </section>

        <section class="right-small" ng-show="!selectedWalletsOpt" ng-click="toggleEditAddressbook()">
          <a ng-show="!editAddressbook && !addAddressbookEntry" href class="p10"
            ng-style="{'color':skin.view.navBarButtonTextColor}">
            <span class="text-close" translate>Edit</span>
          </a>
          <a ng-show="editAddressbook && !addAddressbookEntry" href class="p10"
            ng-style="{'color':skin.view.navBarButtonTextColor}">
            <span class="text-close" translate>Done</span>
          </a>
        </section>

      </div>
    </nav>

    <ion-content class="modal-content p20b"
      ng-class="{'status-bar-content':index.useViewManagedStatusBar}" ng-style="{'background':skin.view.viewBackground}">
      <div class="create-tab small-only-text-center" ng-show="!editAddressbook && !addAddressbookEntry"
        ng-style="{'color':skin.view.viewSectionHeaderColor, 'background':skin.view.viewSectionHeaderBackground, 'border-bottom-color':skin.view.primaryColor}">
        <div class="row">
          <div class="tab-container small-6 medium-3 large-2" 
            ng-class="{'selected':selectedWalletsOpt}"
            ng-style="{'border-bottom-color': selectedWalletsOpt && skin.view.primaryColor}"
            ng-click="selectedWalletsOpt = true">
          <a href
            ng-style="{'color': selectedWalletsOpt ? skin.view.primaryColor : skin.view.viewSecondaryTextColor}"
            ng-click="create.setTotalCopayers(1)" translate> My wallets</a>
          </div>
          <div class="tab-container small-6 medium-3 large-2" 
            ng-class="{'selected':!selectedWalletsOpt}" 
            ng-style="{'border-bottom-color': !selectedWalletsOpt && skin.view.primaryColor}"
            ng-click="selectedWalletsOpt = false">
          <a href
            ng-style="{'color': !selectedWalletsOpt ? skin.view.primaryColor : skin.view.viewSecondaryTextColor}"
            ng-click="create.setTotalCopayers(3)" translate>My contacts</a>
          </div>
        </div>
      </div>
      <div ng-show="selectedWalletsOpt">
        <div class="onGoingProcess" ng-if="gettingAddress">
          <div class="onGoingProcess-content" ng-style="{'background':skin.view.progressBackground, 'color':skin.view.progressTextColor}">
            <div class="spinner">
              <div class="rect1"></div>
              <div class="rect2"></div>
              <div class="rect3"></div>
              <div class="rect4"></div>
              <div class="rect5"></div>
            </div>
            <span translate> Getting address for wallet {{selectedWalletName}} ...</span>
          </div>
        </div>

        <div ng-if="!gettingAddress">
          <ul class="no-bullet">
            <li class="line-b" ng-repeat="w in wallets"
              ng-style="{'background':skin.view.viewListItemBackground, 'border-bottom-color':skin.view.viewListItemSeparatorColor}">
              <a ng-click="selectWallet(w.id, w.name)" class="db oh">
                <div class="avatar-wallet"
                  ng-style="{'color':w.avatarColor, 'background':w.avatarBackground, 'border':w.avatarBorder}"><i class="icon-wallet size-20"></i></div>
                <div class="ellipsis text-black size-14 text-bold" ng-style="{'color':skin.view.viewPrimaryTextColor}">{{w.name || w.id}}</div>
                <div class="size-12" ng-style="{'color':skin.view.viewSecondaryTextColor}">{{w.m}} of {{w.n}}
                  <span ng-show="w.network=='testnet'">[Testnet]</span>
                </div>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div ng-show="!selectedWalletsOpt" class="m20b">
        <ul ng-show="!addAddressbookEntry" class="no-bullet m0" ng-init="list()">
          <li class="p10 line-b" ng-repeat="(addr, label) in list"
            ng-style="{'background':skin.view.viewListItemBackground, 'border-bottom-color':skin.view.viewListItemSeparatorColor}">
            <a ng-show="selectedAddressbook[addr]" 
              class="removeAddressbook" 
              ng-click="remove(addr)" translate><div ng-style="{'color':skin.view.viewAlertTextColor}">Remove</div></a>
            <a class="selectAddressbook" 
              ng-show="editAddressbook" 
              ng-click="toggleSelectAddressbook(addr)">
              <i class="fi-trash" ng-style="{'color':skin.view.viewAlertTextColor}"></i></a> 
            <div ng-click="selectAddressbook(addr)"> 

              <i class="icon-contact left size-42 m10r text-gray" ng-style="{'color':skin.view.viewPrimaryTextColor}"></i> 
              <div>
                <span ng-style="{'color':skin.view.viewPrimaryTextColor}">{{label}}</span>
                <div class="size-12 text-gray ellipsis" ng-style="{'color':skin.view.viewSecondaryTextColor}">{{addr}}</div>
              </div>
            </div> 
          </li>
          <li class="p10 line-b pointer" style="line-height: 41px" ng-click="toggleAddAddressbookEntry()" ng-show="!editAddressbook"
            ng-style="{'background':skin.view.viewListItemBackground, 'border-bottom-color':skin.view.viewListItemSeparatorColor}">
            <a class="p0i">
              <i class="fi-plus size-24 m20r lh icon" ng-style="{'color':skin.view.viewSecondaryTextColor}"></i> 
              <span class="size-12 tu text-bold" ng-style="{'color':skin.view.viewSecondaryTextColor}" translate>Add a new entry</span>
              <span class="size-10" ng-style="{'color':skin.view.viewSecondaryTextColor}" ng-show="!list[newAddress] && newAddress">({{newAddress}})</span>
            </a>
          </li>
        </ul>

        <div ng-show="addAddressbookEntry">
          <h4 ng-style="{'color':skin.view.viewSectionHeaderColor, 'background':skin.view.viewSectionHeaderBackground}" translate>Add a new entry</h4>
          <form name="addressbookForm" class="p10" no-validate>
            <div class="size-14 m10b" ng-style="{'color':skin.view.viewAlertTextColor}" ng-show="error">{{error|translate}}</div>
            <span ng-hide="addressbookForm.address.$pristine">
              <span class="has-error right size-14" ng-style="{'color':skin.view.viewAlertTextColor}" ng-show="addressbookForm.address.$invalid && addressbook.address">
                <i class="icon-close-circle size-14"></i>
                <span class="vm" translate>Not valid</span>
              </span>
              <small class="right" ng-style="{'color':skin.view.viewSuccessTextColor}" ng-show="!addressbookForm.address.$invalid">
                <i class="icon-checkmark-circle size-14"></i>
              </small>
            </span>

            <label ng-style="{'color':skin.view.viewPrimaryTextColor}" translate>Address</label>
            <div class="input">
              <input type="text" id="address" name="address" ng-model="addressbook.address" valid-address required
                ng-style="{'color':skin.view.viewSecondaryTextColor, 'border-bottom-color':skin.view.viewListItemSeparatorColor}">
              <div class="qr-scanner-input" ng-style="{'color':skin.view.viewPrimaryTextColor}">
                <qr-scanner on-scan="onQrCodeScanned(data, addressbookForm)" before-scan="beforeQrCodeScann()"></qr-scanner>
              </div>
            </div>
            
            <label ng-style="{'color':skin.view.viewPrimaryTextColor}" translate>Label</label>
            <input type="text" id="label" name="label" ng-model="addressbook.label" required
              ng-style="{'color':skin.view.viewSecondaryTextColor, 'border-bottom-color':skin.view.viewListItemSeparatorColor}">
            <div class="row">
              <div class="columns large-6 medium-6 small-6">
                <input type="button" 
                       class="button expand outline dark-gray round"
                       ng-style="{'background':skin.view.secondaryButtonBackground, 'border':skin.view.secondaryButtonBorder, 'color':skin.view.secondaryButtonTextColor}" 
                       ng-click="newAddress = ''; toggleAddAddressbookEntry()"
                       value="{{'Cancel'|translate}}">
              </div>
              <div class="columns large-6 medium-6 small-6">
                <input type="submit" 
                       class="button expand round black" 
                       value="{{'Save'|translate}}"
                       ng-disabled="!addressbookForm.$valid"
                       ng-style="{'background':skin.view.primaryButtonBackground, 'border':skin.view.primaryButtonBorder, 'color':skin.view.primaryButtonTextColor}"
                       ng-click="newAddress = ''; add(addressbook)">
              </div>
            </div>
          </form>
        
        </div>

      </div>

      <div class="extra-margin-bottom"></div>
    </ion-content>
  </div>
</ion-modal-view>
